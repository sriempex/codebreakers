<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, maximum-scale=1.0, user-scalable=no">
<title>Operation Dead Drop ‚Äî Console</title>
<link href="https://fonts.googleapis.com/css2?family=Staatliches&family=Chakra+Petch:wght@400;500;600;700&family=IBM+Plex+Mono:wght@400;500;600;700&family=Saira:wght@400;500;600;700&family=Oxanium:wght@400;600;700&family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Black+Ops+One&family=Share+Tech+Mono&family=Russo+One&family=Exo+2:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600;700&family=Rajdhani:wght@400;500;600;700&family=Teko:wght@400;500;600;700&family=Play:wght@400;700&family=Audiowide&family=Press+Start+2P&family=VT323&family=Silkscreen&family=Major+Mono+Display&family=Nova+Mono&family=Aldrich&family=Electrolize&family=Michroma&family=Quantico:wght@400;700&display=swap" rel="stylesheet" media="print" onload="this.media='all'">

<!-- CSS Modules -->
<link rel="stylesheet" href="./css/base.css">
<link rel="stylesheet" href="./css/registration.css">
<link rel="stylesheet" href="./css/landing.css">
<link rel="stylesheet" href="./css/login.css">
<link rel="stylesheet" href="./css/vault.css">
<link rel="stylesheet" href="./css/console.css">
<link rel="stylesheet" href="./css/themes.css">
<link rel="stylesheet" href="./css/panels.css">
<link rel="stylesheet" href="./css/intel-themes.css">
<link rel="stylesheet" href="./css/admin.css">
<link rel="stylesheet" href="./css/responsive.css">
<link rel="stylesheet" href="./css/admin-extra.css">

<!-- GSAP Animation Engine -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>

<!-- Three.js 3D Engine -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

<!-- Tone.js Audio Synthesis -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.min.js"></script>

<!-- Lottie Animation Player -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.12.2/lottie.min.js"></script>

<!-- Pre-render theme injection (runs before body paints) -->
<script src="./js/pre-render.js"></script>

<!-- PDF.js -->
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
<script defer src="./js/pdfjs-config.js"></script>

</head>
<body class="config-hydrating">
<canvas id="grainCanvas"></canvas>
<div class="flash-green" id="flashG"></div>
<div class="flash-red" id="flashR"></div>


<!-- PERSISTENT ADMIN ICONS -->
<div class="admin-persistent-icons" id="adminPersistentIcons">
  <div class="admin-icon admin-icon-preview" id="adminPreviewIcon" onclick="togglePlayerPreview()" title="View as Player">
    <svg viewBox="0 0 24 24"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
  </div>
  <div class="admin-icon admin-icon-gear" id="adminGearIcon" onclick="handleGearClick()" title="Admin Menu">
    <svg viewBox="0 0 24 24"><path d="M12 15.5A3.5 3.5 0 0 1 8.5 12 3.5 3.5 0 0 1 12 8.5a3.5 3.5 0 0 1 3.5 3.5 3.5 3.5 0 0 1-3.5 3.5m7.43-2.53a7.76 7.76 0 0 0 0-1.94l2.11-1.65a.5.5 0 0 0 .12-.64l-2-3.46a.5.5 0 0 0-.61-.22l-2.49 1a7.2 7.2 0 0 0-1.69-.98l-.38-2.65A.49.49 0 0 0 14 2h-4a.49.49 0 0 0-.49.42l-.38 2.65a7.2 7.2 0 0 0-1.69.98l-2.49-1a.5.5 0 0 0-.61.22l-2 3.46a.49.49 0 0 0 .12.64l2.11 1.65a7.9 7.9 0 0 0 0 1.94l-2.11 1.65a.5.5 0 0 0-.12.64l2 3.46a.5.5 0 0 0 .61.22l2.49-1c.52.4 1.08.72 1.69.98l.38 2.65c.05.24.26.42.49.42h4c.24 0 .44-.18.49-.42l.38-2.65a7.2 7.2 0 0 0 1.69-.98l2.49 1a.5.5 0 0 0 .61-.22l2-3.46a.49.49 0 0 0-.12-.64z"/></svg>
  </div>
</div>

<!-- GEAR DROPDOWN -->
<div class="gear-dropdown" id="gearDropdown">
  <div class="gear-dropdown-item" onclick="closeGearDropdown();navigateToAdmin('settingsScreen')"><span class="gd-label">Settings</span></div>
  <div class="gear-dropdown-item" onclick="closeGearDropdown();navigateToAdmin('settingsScreen','dash-teams')"><span class="gd-label">Teams</span></div>
  <div class="gear-dropdown-item" onclick="closeGearDropdown();navigateToAdmin('settingsScreen','dash-broadcast')"><span class="gd-label">Broadcast</span></div>
</div>

<div class="admin-trigger" id="adminTrigger" onclick="handleAdminTrigger()" title="System"><svg viewBox="0 0 24 24"><path d="M12 15.5A3.5 3.5 0 0 1 8.5 12 3.5 3.5 0 0 1 12 8.5a3.5 3.5 0 0 1 3.5 3.5 3.5 3.5 0 0 1-3.5 3.5m7.43-2.53a7.76 7.76 0 0 0 0-1.94l2.11-1.65a.5.5 0 0 0 .12-.64l-2-3.46a.5.5 0 0 0-.61-.22l-2.49 1a7.2 7.2 0 0 0-1.69-.98l-.38-2.65A.49.49 0 0 0 14 2h-4a.49.49 0 0 0-.49.42l-.38 2.65a7.2 7.2 0 0 0-1.69.98l-2.49-1a.5.5 0 0 0-.61.22l-2 3.46a.49.49 0 0 0 .12.64l2.11 1.65a7.9 7.9 0 0 0 0 1.94l-2.11 1.65a.5.5 0 0 0-.12.64l2 3.46a.5.5 0 0 0 .61.22l2.49-1c.52.4 1.08.72 1.69.98l.38 2.65c.05.24.26.42.49.42h4c.24 0 .44-.18.49-.42l.38-2.65a7.2 7.2 0 0 0 1.69-.98l2.49 1a.5.5 0 0 0 .61-.22l2-3.46a.49.49 0 0 0-.12-.64z"/></svg></div>

<!-- Admin Dropdown Menu -->
<div class="admin-dropdown" id="adminDropdown">
  <div class="admin-dropdown-header">
    <div class="admin-dropdown-dot"></div>
    <span class="admin-dropdown-label">Admin Menu</span>
  </div>
  <div class="admin-dropdown-body">
    <div class="adm-tier-label">LIVE</div>
    <div class="admin-dropdown-item" onclick="closeAdminDropdown();openDashboard()"><span class="adm-label">Dashboard</span></div>
    <div class="adm-tier-label">SETUP</div>
    <div class="admin-dropdown-item" onclick="closeAdminDropdown();openSetup('adminPanel')"><span class="adm-label">Event</span></div>
    <div class="admin-dropdown-item" onclick="closeAdminDropdown();openSetup('keysCodesPanel')"><span class="adm-label">Intel & Scoring</span></div>
    <div class="admin-dropdown-item" onclick="closeAdminDropdown();openSetup('appearancePanel')"><span class="adm-label">Appearance</span></div>
    <div class="admin-dropdown-item" onclick="closeAdminDropdown();openSetup('portalUsersPanel')"><span class="adm-label">Users & Sessions</span></div>
    <div class="admin-dropdown-sep"></div>

    <div class="admin-dropdown-toggle pp-toggle" onclick="togglePlayerPreview()"><span class="adm-label">View as Player</span><span class="adm-toggle off" id="admPreviewToggle">OFF</span></div>
  </div>
</div>

<div class="notepad-trigger" id="notepadTrigger" onclick="toggleNotepad()"><svg viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><line x1="10" y1="9" x2="8" y2="9"/></svg><span>Notepad</span><div class="notepad-dot" id="notepadDot"></div></div>

<div id="logoutModal"><div class="logout-box" id="logoutBoxContent"></div></div>

<div id="adminEditModal"><div class="edit-box" id="editBox"></div></div>

<div id="confirmModal"><div class="confirm-box"><div class="confirm-header"><h3>‚ö† Confirm Transmission</h3><p>Review your intel before final submission. This action cannot be undone.</p></div><div class="confirm-body" id="confirmBody"></div><div class="confirm-footer"><button class="intel-submit-btn intel-confirm-back" onclick="hideConfirm()">‚óÇ GO BACK</button><button class="intel-submit-btn intel-confirm-send" onclick="finalSubmit()">CONFIRM AND SUBMIT</button></div></div></div>

<!-- ADMIN CHOICE MODAL (after auth from landing) -->
<div id="adminChoiceModal"><div class="admin-choice-box"><h3>‚óà Navigation</h3><p>Where would you like to go?</p><div class="admin-choice-btns"><button class="btn-standard btn-cyan" onclick="adminGoVault()">Go to Vault</button><button class="btn-standard btn-green" onclick="adminGoConsole()">Go to Console</button></div></div></div>

<!-- LANDING PAGE -->
<div class="screen active" id="landingScreen">
  <div class="landing-circuits">
    <svg viewBox="0 0 1200 800" preserveAspectRatio="xMidYMid slice" xmlns="http://www.w3.org/2000/svg">
      <defs>
        <radialGradient id="cGlow" cx="50%" cy="40%" r="50%"><stop offset="0%" stop-color="rgba(0,255,136,.06)"/><stop offset="100%" stop-color="transparent"/></radialGradient>
      </defs>
      <rect fill="url(#cGlow)" width="1200" height="800"/>
      <!-- Horizontal traces -->
      <line x1="0" y1="120" x2="320" y2="120" stroke="rgba(0,255,136,.12)" stroke-width=".8"/>
      <line x1="380" y1="120" x2="600" y2="120" stroke="rgba(0,255,136,.08)" stroke-width=".5"/>
      <line x1="0" y1="280" x2="180" y2="280" stroke="rgba(0,212,255,.1)" stroke-width=".8"/>
      <line x1="240" y1="280" x2="440" y2="280" stroke="rgba(0,212,255,.06)" stroke-width=".5"/>
      <line x1="700" y1="200" x2="1200" y2="200" stroke="rgba(0,255,136,.1)" stroke-width=".8"/>
      <line x1="800" y1="350" x2="1200" y2="350" stroke="rgba(0,212,255,.08)" stroke-width=".5"/>
      <line x1="0" y1="500" x2="250" y2="500" stroke="rgba(0,255,136,.07)" stroke-width=".5"/>
      <line x1="900" y1="520" x2="1200" y2="520" stroke="rgba(0,255,136,.09)" stroke-width=".8"/>
      <line x1="0" y1="650" x2="350" y2="650" stroke="rgba(0,212,255,.08)" stroke-width=".5"/>
      <line x1="750" y1="680" x2="1200" y2="680" stroke="rgba(0,212,255,.06)" stroke-width=".5"/>
      <!-- Vertical traces -->
      <line x1="320" y1="0" x2="320" y2="180" stroke="rgba(0,255,136,.1)" stroke-width=".8"/>
      <line x1="320" y1="120" x2="320" y2="280" stroke="rgba(0,255,136,.06)" stroke-width=".5"/>
      <line x1="180" y1="280" x2="180" y2="500" stroke="rgba(0,212,255,.08)" stroke-width=".5"/>
      <line x1="900" y1="0" x2="900" y2="200" stroke="rgba(0,255,136,.08)" stroke-width=".5"/>
      <line x1="900" y1="200" x2="900" y2="520" stroke="rgba(0,255,136,.05)" stroke-width=".5"/>
      <line x1="440" y1="280" x2="440" y2="800" stroke="rgba(0,212,255,.05)" stroke-width=".5"/>
      <line x1="750" y1="350" x2="750" y2="680" stroke="rgba(0,212,255,.06)" stroke-width=".5"/>
      <line x1="1050" y1="0" x2="1050" y2="350" stroke="rgba(0,255,136,.06)" stroke-width=".5"/>
      <line x1="120" y1="500" x2="120" y2="800" stroke="rgba(0,255,136,.05)" stroke-width=".5"/>
      <!-- Angled traces -->
      <line x1="600" y1="120" x2="700" y2="200" stroke="rgba(0,255,136,.07)" stroke-width=".5"/>
      <line x1="250" y1="500" x2="350" y2="650" stroke="rgba(0,212,255,.06)" stroke-width=".5"/>
      <line x1="800" y1="350" x2="750" y2="520" stroke="rgba(0,255,136,.05)" stroke-width=".5"/>
      <!-- Junction nodes -->
      <circle cx="320" cy="120" r="3" fill="rgba(0,255,136,.2)"/><circle cx="320" cy="120" r="1.2" fill="rgba(0,255,136,.5)"/>
      <circle cx="180" cy="280" r="3" fill="rgba(0,212,255,.2)"/><circle cx="180" cy="280" r="1.2" fill="rgba(0,212,255,.5)"/>
      <circle cx="440" cy="280" r="2.5" fill="rgba(0,212,255,.15)"/><circle cx="440" cy="280" r="1" fill="rgba(0,212,255,.4)"/>
      <circle cx="900" cy="200" r="3" fill="rgba(0,255,136,.2)"/><circle cx="900" cy="200" r="1.2" fill="rgba(0,255,136,.5)"/>
      <circle cx="900" cy="520" r="2.5" fill="rgba(0,255,136,.15)"/><circle cx="900" cy="520" r="1" fill="rgba(0,255,136,.4)"/>
      <circle cx="700" cy="200" r="2.5" fill="rgba(0,255,136,.15)"/><circle cx="700" cy="200" r="1" fill="rgba(0,255,136,.4)"/>
      <circle cx="600" cy="120" r="2" fill="rgba(0,255,136,.12)"/><circle cx="600" cy="120" r=".8" fill="rgba(0,255,136,.3)"/>
      <circle cx="250" cy="500" r="2.5" fill="rgba(0,255,136,.15)"/><circle cx="250" cy="500" r="1" fill="rgba(0,255,136,.4)"/>
      <circle cx="800" cy="350" r="3" fill="rgba(0,212,255,.18)"/><circle cx="800" cy="350" r="1.2" fill="rgba(0,212,255,.45)"/>
      <circle cx="750" cy="680" r="2.5" fill="rgba(0,212,255,.15)"/><circle cx="750" cy="680" r="1" fill="rgba(0,212,255,.4)"/>
      <circle cx="350" cy="650" r="2.5" fill="rgba(0,212,255,.15)"/><circle cx="350" cy="650" r="1" fill="rgba(0,212,255,.4)"/>
      <circle cx="120" cy="500" r="2" fill="rgba(0,255,136,.12)"/><circle cx="120" cy="500" r=".8" fill="rgba(0,255,136,.3)"/>
      <circle cx="1050" cy="350" r="2.5" fill="rgba(0,255,136,.15)"/><circle cx="1050" cy="350" r="1" fill="rgba(0,255,136,.4)"/>
      <!-- IC chip shapes -->
      <rect x="295" y="95" width="50" height="50" rx="3" fill="none" stroke="rgba(0,255,136,.06)" stroke-width=".5"/>
      <rect x="875" y="175" width="50" height="50" rx="3" fill="none" stroke="rgba(0,255,136,.06)" stroke-width=".5"/>
      <rect x="775" y="325" width="50" height="50" rx="3" fill="none" stroke="rgba(0,212,255,.06)" stroke-width=".5"/>
      <!-- Pulsing nodes -->
      <circle cx="320" cy="120" r="6" fill="none" stroke="rgba(0,255,136,.1)" stroke-width=".3"><animate attributeName="r" values="3;8;3" dur="3s" repeatCount="indefinite"/><animate attributeName="opacity" values=".3;0;.3" dur="3s" repeatCount="indefinite"/></circle>
      <circle cx="900" cy="200" r="6" fill="none" stroke="rgba(0,255,136,.1)" stroke-width=".3"><animate attributeName="r" values="3;8;3" dur="4s" repeatCount="indefinite"/><animate attributeName="opacity" values=".3;0;.3" dur="4s" repeatCount="indefinite"/></circle>
      <circle cx="800" cy="350" r="6" fill="none" stroke="rgba(0,212,255,.1)" stroke-width=".3"><animate attributeName="r" values="3;8;3" dur="3.5s" repeatCount="indefinite"/><animate attributeName="opacity" values=".3;0;.3" dur="3.5s" repeatCount="indefinite"/></circle>
    </svg>
  </div>
  <div class="landing-container">
    <div class="landing-banner" id="landingBannerWrap">
      <span class="landing-banner-icon">üîê</span>
      <img class="landing-banner-img" id="landingBannerImg" alt="Code Breakers">
      <div class="landing-banner-upload" onclick="document.getElementById('landingBannerFile').click()" title="Upload banner">üì∑</div>
      <input type="file" id="landingBannerFile" accept="image/*" onchange="handleBannerUpload(this)">
    </div>
    <div class="landing-title" id="landingTitleEl">Code Breakers</div>
    <div class="landing-subtitle" id="landingSubEl">Rise to The Challenge</div>
    <div class="landing-actions">
      <div class="landing-login-btn" onclick="goToLogin()">READY</div>
    </div>
  </div>
  <div class="landing-footer"><span>¬© 2026 Sandals Employee Experience. All rights reserved.</span></div>
</div>

<!-- REGISTRATION -->
<div class="screen" id="regScreen">
  <div class="reg-container">
    <div class="reg-title" id="regScreenTitle">Operation Dead Drop</div>
    <div class="reg-subtitle" id="regScreenSubtitle">Team Registration Portal</div>
    <div class="reg-panel">
      <div class="login-led" id="regLed"></div>
      <div class="rv rv-1"></div><div class="rv rv-2"></div><div class="rv rv-3"></div><div class="rv rv-4"></div>
      <div class="reg-crt" id="regCrt">
        <div class="login-crt-scanlines"></div>
        <div class="reg-crt-inner" id="regForm">
          <!-- Hybrid mode type choice (hidden unless hybrid) -->
          <div class="reg-type-choice" id="regTypeChoice" style="display:none">
            <div class="reg-type-btn selected" data-type="team" onclick="selectRegType(this)">
              <div class="rtype-icon">üë•</div>
              <div class="rtype-label">Team</div>
            </div>
            <div class="reg-type-btn" data-type="individual" onclick="selectRegType(this)">
              <div class="rtype-icon">üë§</div>
              <div class="rtype-label">Individual</div>
            </div>
          </div>

          <div class="reg-section">
            <div class="reg-field full">
              <label class="reg-main-label">Team Name</label>
              <input type="text" id="regTeamName" placeholder="Enter your team name" maxlength="30">
            </div>
          </div>

          <div class="reg-section">
            <div id="regOperatives"></div>
          </div>

          <div class="reg-err" id="regErr" style="display:none"></div>
        </div>
        <div class="reg-crt-inner" id="regSuccess" style="display:none">
          <div class="reg-section-title" style="text-align:center;border-bottom:none;margin-bottom:8px">‚óà Registration Complete</div>
          <div class="reg-id-display">
            <div class="reg-id-label">Your Team ID</div>
            <div class="reg-id-value" id="regTeamId">‚Äî</div>
          </div>
          <div class="reg-id-warn">‚ö† Save this ID ‚Äî you'll need it to resume your session</div>
          <div class="reg-id-note">Share this ID with your team members. Any member can access and continue the mission using this code on any device.</div>
          <button class="reg-proceed" onclick="proceedToLogin()">Proceed to Mission ‚ñ∏</button>
        </div>
      </div>
      <div class="login-crt-divider" id="regCrtDivider" style="display:none;margin:0 18px"></div>
      <div class="login-crt-status" id="regCrtStatus" style="padding:0 18px 8px"></div>
      <div class="login-btn-row" id="regBtnRow">
        <div class="login-hw-btn esc-key" onclick="regBack()"><span>‚Üê ESC</span></div>
        <div class="login-hw-btn enter-key" id="regSubmitBtn" onclick="submitRegistration()"><span>REGISTER</span></div>
      </div>
    </div>
  </div>
</div>

<!-- LOGIN -->
<div class="screen" id="loginScreen">
  <div class="login-container">
    <div style="display:flex;align-items:center;justify-content:center"><div class="login-title" id="loginTitle">Operation Dead Drop</div><button class="admin-edit-inline" onclick="event.stopPropagation();editOperationName()">‚úé</button></div>
    <div class="login-subtitle">Enter Your Credentials</div>
    <div class="login-panel">
      <div class="login-led" id="loginLed"></div>
      <div class="rv rv-1"></div><div class="rv rv-2"></div><div class="rv rv-3"></div><div class="rv rv-4"></div>
      <div class="login-crt-unified" id="loginCrt">
        <div class="login-crt-scanlines"></div>
        <div class="login-crt-inner">
          <div class="login-crt-input-zone">
            <label class="login-crt-label" id="loginCrtLabel">TEAM ID</label>
            <input type="text" class="login-crt-field" id="loginId" placeholder="e.g. ALPHA-1234" autocomplete="off" spellcheck="false">
          </div>
          <div class="login-crt-pw-zone" id="loginCrtPwZone" style="display:none">
            <div class="login-crt-divider"></div>
            <label class="login-crt-label">PASSWORD</label>
            <input type="password" class="login-crt-field" id="loginPw" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
          </div>
          <div class="login-crt-divider" id="loginCrtDivider" style="display:none"></div>
          <div class="login-crt-status" id="loginCrtStatus"></div>
        </div>
      </div>
      <div class="login-err" id="loginErr" style="display:none"></div>
      <div class="login-btn-row">
        <div class="login-hw-btn esc-key" id="loginEscBtn" onclick="loginBack()"><span>‚Üê ESC</span></div>
        <div class="login-hw-btn enter-key" id="loginSubmitBtn" onclick="submitLogin()"><span>ENTER</span></div>
      </div>
    </div>
    <div class="login-register-link" id="loginRegLink" onclick="goToRegistration()"><span id="loginRegText">Don't have a Team ID?</span> <span class="lrl-action" id="loginRegAction">Register here</span></div>
  </div>
</div>

<div id="vaultOpenOverlay"><div class="vo-text" id="voText">ACCESS GRANTED</div><div class="vo-sub" id="voSub">Initializing operations console...</div><div class="vo-bar" id="voBar"><div class="vo-fill" id="voFill"></div></div><div class="vo-pct" id="voPct">0%</div></div>

<!-- ADMIN BAR (fixed, body-level) -->
<!-- CONSOLE -->
<div class="screen" id="consoleScreen">
<div id="consoleBgOverlay"></div>

<!-- CHANGE PASSWORD MODAL -->
<div id="changePwModal" style="display:none;position:fixed;inset:0;z-index:920;background:rgba(0,0,0,.7);backdrop-filter:blur(4px);align-items:center;justify-content:center" onclick="if(event.target===this)closeChangePassword()">
  <div style="background:#0a0e18;border:1px solid var(--border);border-radius:6px;padding:24px;width:340px;max-width:90vw">
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:16px">
      <h4 style="font-family:Saira,sans-serif;font-size:13px;letter-spacing:3px;color:#d0e8f0;text-transform:uppercase;margin:0;font-weight:700">üîë Change Password</h4>
      <button class="mv-close" onclick="closeChangePassword()" style="position:static;font-size:10px;padding:4px 10px">‚úï</button>
    </div>
    <div class="ap-field"><label>Current Password</label><input type="password" id="apCurPw"></div>
    <div class="ap-field"><label>New Password</label><input type="password" id="apNewPw"></div>
    <div class="ap-field"><label>Confirm New Password</label><input type="password" id="apConfPw"></div>
    <button class="ap-btn ap-btn-cyan" onclick="changeAdminPw()" style="width:100%;margin-top:4px">Update Password</button>
    <div class="ap-msg" id="apPwMsg"></div>
  </div>
</div>

<!-- PORTAL USERS PANEL -->
<div id="portalUsersPanel">
  <div class="ap-container">
    <div class="ap-header"><h3>Users & Sessions</h3><button class="mv-close" onclick="closePortalUsers()">‚úï CLOSE</button></div>
    <div class="ap-section"><h4>Administrators</h4>
      <p>Administrators can access the admin menu and all management tools.</p>
      <div class="ap-row">
        <div class="ap-field"><label>Username</label><input id="apAddUser"></div>
        <div class="ap-field"><label>Password</label><input id="apAddPw" type="password"></div>
        <button class="ap-btn ap-btn-green" onclick="addAdmin()" style="flex-shrink:0;margin-bottom:10px">+ Add</button>
      </div>
      <div class="ap-msg" id="apAdminMsg"></div>
    </div>
    <div class="ap-section"><h4>Create ID</h4>
      <p id="apManualDesc">Manually create teams or individuals with custom or auto-generated IDs.</p>
      <div class="ap-row" id="apManualTypeRow" style="margin-bottom:10px">
        <div class="ap-field"><label>Entry Type</label><select id="apManualType" onchange="onManualTypeChange()" style="background:#080a10;border:1px solid var(--border);border-radius:4px;padding:10px 14px;color:#ddd;font-family:'IBM Plex Mono',monospace;font-size:12px;width:100%;outline:none"><option value="team">Team</option><option value="individual">Individual</option></select></div>
      </div>
      <div class="ap-row">
        <div class="ap-field"><label id="apManualNameLabel">Team Name</label><input id="apTeamName" placeholder="e.g. Alpha Squad"></div>
        <div class="ap-field"><label id="apManualIdLabel">Team ID (leave blank to auto-generate)</label><input id="apTeamId" placeholder="Auto-generated"></div>
      </div>
      <div style="display:flex;gap:8px;align-items:center">
        <button class="ap-btn ap-btn-green" id="apManualCreateBtn" onclick="createManualTeam()">Create Team</button>
        <button class="ap-btn ap-btn-cyan" onclick="autoGenTeamId()" style="font-size:8px">üé≤ Generate ID</button>
      </div>
      <div class="ap-msg" id="apTeamMsg"></div>
    </div>
    <div class="ap-section"><h4>Portal Users</h4>
      <p>All administrators and manually created entries.</p>
      <div id="puCombinedList"></div>
    </div>
  </div>
</div>

<!-- SESSION MANAGEMENT PANEL -->
<div id="sessionMgmtPanel">
  <div class="ap-container" style="width:700px">
    <div class="ap-header"><h3>Session Management</h3><button class="mv-close" onclick="closeSessionMgmt()">‚úï CLOSE</button></div>
    <div class="ap-section">
      <h4>Active Sessions</h4>
      <p>Invalidate active sessions. Affected users will be returned to the login screen on their next action.</p>
      <div class="session-btn-group">
        <div class="session-btn session-btn-safe" onclick="destroySessions('teams')">
          <span class="sb-icon" style="font-family:'IBM Plex Mono',monospace;font-weight:700;font-size:18px;color:var(--green)">!</span>
          <div class="sb-info"><span class="sb-title">DESTROY TEAM SESSIONS</span><span class="sb-desc">Kick all players ‚Äî admins stay logged in</span></div>
        </div>
        <div class="session-btn session-btn-warn" onclick="destroySessions('exceptMe')">
          <span class="sb-icon" style="font-family:'IBM Plex Mono',monospace;font-weight:700;font-size:18px;color:var(--amber)">!</span>
          <div class="sb-info"><span class="sb-title">DESTROY ALL EXCEPT ME</span><span class="sb-desc">Kick everyone ‚Äî your session is preserved</span></div>
        </div>
        <div class="session-btn session-btn-danger" onclick="destroySessions('all')">
          <span class="sb-icon" style="font-family:'IBM Plex Mono',monospace;font-weight:700;font-size:18px;color:var(--red)">!</span>
          <div class="sb-info"><span class="sb-title">DESTROY ALL SESSIONS</span><span class="sb-desc">Nuclear option ‚Äî everyone including you gets kicked</span></div>
        </div>
      </div>
      <div class="ap-msg" id="sessionMgmtMsg" style="margin-top:12px"></div>
      <div style="margin-top:24px;padding-top:16px;border-top:1px solid var(--border)">
        <h4 style="color:#ff4444">Nuke Teams</h4>
        <p>Permanently delete teams and ALL their data ‚Äî submissions, drafts, vault progress, leaderboard entries. This cannot be undone.</p>
        <div class="session-btn-group">
          <div class="session-btn session-btn-danger" onclick="nukeAllTeams()">
            <span class="sb-icon" style="font-family:'IBM Plex Mono',monospace;font-weight:700;font-size:18px;color:var(--red)">!!</span>
            <div class="sb-info"><span class="sb-title">NUKE ALL TEAMS</span><span class="sb-desc">Delete every team and their data ‚Äî total wipe</span></div>
          </div>
        </div>
        <div class="ap-msg" id="nukeMgmtMsg" style="margin-top:12px"></div>
      </div>
    </div>
  </div>
</div>

<!-- TUTORIAL & BRIEFING CONFIG PANEL -->
<div id="tutorialConfigPanel">
  <div class="ap-container">
    <div class="ap-header"><h3>Tutorial & Briefing</h3><button class="mv-close" onclick="closeTutorialConfig()">‚úï CLOSE</button></div>
    <div class="ap-section">
      <h4>Navigation Tutorial</h4>
      <p>Step-by-step spotlight tour shown to players on first login. Drag to reorder, toggle to enable/disable each step, edit text to customize.</p>
      <div style="display:flex;align-items:center;gap:12px;margin-bottom:12px">
        <span style="font-family:Saira,sans-serif;font-size:10px;letter-spacing:1.5px;color:#888">TUTORIAL</span>
        <div class="tut-step-toggle" id="tutGlobalToggle" onclick="toggleTutorialGlobal()"><span></span></div>
        <button class="ap-btn ap-btn-ghost" onclick="resetTutorialForAll()" style="font-size:8px;padding:5px 12px;margin-left:auto">‚Ü∫ Reset for All Teams</button>
        <button class="ap-btn ap-btn-ghost" onclick="previewTutorial()" style="font-size:8px;padding:5px 12px">‚ñ∂ Preview</button>
      </div>
      <div class="tut-step-list" id="tutStepList"></div>
    </div>
    <div class="ap-section">
      <h4>Mission Briefing</h4>
      <p>Video shown to players after first login (after the tutorial if both are enabled). Plays once per team.</p>
      <div style="display:flex;align-items:center;gap:12px;margin-bottom:12px">
        <span style="font-family:Saira,sans-serif;font-size:10px;letter-spacing:1.5px;color:#888">BRIEFING</span>
        <div class="tut-step-toggle" id="briefingGlobalToggle" onclick="toggleBriefingGlobal()"><span></span></div>
        <button class="ap-btn ap-btn-ghost" onclick="resetBriefingForAll()" style="font-size:8px;padding:5px 12px;margin-left:auto">‚Ü∫ Reset for All Teams</button>
        <button class="ap-btn ap-btn-ghost" onclick="previewBriefing()" style="font-size:8px;padding:5px 12px">‚ñ∂ Preview</button>
      </div>
      <div class="ap-row" style="margin-bottom:10px">
        <div class="ap-field"><label>Source Type</label>
          <select id="briefingSourceType" onchange="onBriefingTypeChange()" style="background:#080a10;border:1px solid var(--border);border-radius:4px;padding:10px 14px;color:#ddd;font-family:'IBM Plex Mono',monospace;font-size:12px;width:100%;outline:none">
            <option value="upload">Upload Video (R2)</option>
            <option value="youtube">YouTube / Vimeo Link</option>
            <option value="direct">Direct Video URL</option>
          </select>
        </div>
      </div>
      <div id="briefingUploadZone" class="ap-row" style="margin-bottom:10px">
        <div class="ap-field" style="flex:1"><label>Video File</label>
          <div style="display:flex;gap:8px;align-items:center">
            <input id="briefingFileUrl" readonly placeholder="No video uploaded" style="flex:1;background:#060810;border:1px solid var(--border);border-radius:4px;padding:10px;color:#aaa;font-size:11px">
            <label style="cursor:pointer;padding:8px 14px;background:rgba(0,212,255,.08);border:1px solid rgba(0,212,255,.2);border-radius:4px;color:var(--cyan);font-family:Saira,sans-serif;font-size:9px;letter-spacing:1px;white-space:nowrap">
              üìÅ Upload<input type="file" accept="video/*" style="display:none" onchange="uploadBriefingVideo(this)">
            </label>
          </div>
        </div>
      </div>
      <div id="briefingUrlZone" class="ap-row" style="margin-bottom:10px;display:none">
        <div class="ap-field" style="flex:1"><label>Video URL</label>
          <input id="briefingVideoUrl" placeholder="https://youtube.com/watch?v=... or direct .mp4 URL" oninput="saveBriefingConfig()" style="background:#060810;border:1px solid var(--border);border-radius:4px;padding:10px;color:#ddd;font-size:11px;width:100%">
        </div>
      </div>
      <div class="ap-row" style="margin-bottom:10px">
        <div class="ap-field"><label>Title (optional)</label><input id="briefingTitle" placeholder="Mission Briefing" oninput="saveBriefingConfig()"></div>
        <div class="ap-field"><label>Subtitle (optional)</label><input id="briefingSubtitle" placeholder="Watch carefully, agent." oninput="saveBriefingConfig()"></div>
      </div>
      <div class="ap-msg" id="briefingMsg" style="margin-top:4px"></div>
    </div>
  </div>
</div>

<!-- TUTORIAL SPOTLIGHT OVERLAY -->
<div id="tutorialOverlay">
  <div class="tut-spotlight" id="tutSpotlight"></div>
  <div class="tut-tooltip" id="tutTooltip">
    <div class="tut-tooltip-title" id="tutTooltipTitle"></div>
    <div class="tut-tooltip-body" id="tutTooltipBody"></div>
    <div class="tut-tooltip-nav">
      <div class="tut-tooltip-dots" id="tutDots"></div>
      <div class="tut-tooltip-btns">
        <div class="tut-btn tut-btn-skip" id="tutBtnSkip" onclick="endTutorial()">EXIT</div>
        <div class="tut-btn tut-btn-back" id="tutBtnBack" onclick="tutorialStep(-1)">BACK</div>
        <div class="tut-btn tut-btn-next" id="tutBtnNext" onclick="tutorialStep(1)">NEXT</div>
      </div>
    </div>
  </div>
</div>

<!-- MISSION BRIEFING MODAL -->
<div id="briefingModal">
  <div class="briefing-container">
    <div class="briefing-header">
      <div class="briefing-title" id="briefingModalTitle">Mission Briefing</div>
      <div class="briefing-subtitle" id="briefingModalSubtitle"></div>
    </div>
    <div class="briefing-video" id="briefingVideoContainer"></div>
    <div class="briefing-footer">
      <button class="briefing-continue" onclick="dismissBriefing()">‚óà CONTINUE TO MISSION ‚óà</button>
    </div>
  </div>
</div>

<!-- EVENT SETTINGS PANEL -->
<div id="adminPanel">
  <div class="ap-container">
    <div class="ap-header"><h3>Configuration</h3><button class="mv-close" onclick="closeEventSettings()">‚úï CLOSE</button></div>
    <div class="ap-section"><h4>Event Settings <span class="save-blip" id="blipEventSettings">‚úì Saved</span></h4>
      <p>Configure participant mode, countdown timer, and leaderboard display.</p>
      <div style="margin-bottom:16px">
        <label style="font-family:Saira,sans-serif;font-size:10px;color:#d0e8f0;letter-spacing:2px;text-transform:uppercase;font-weight:700;display:block;margin-bottom:8px">‚è± Event Timer</label>
        <div style="display:flex;gap:16px;align-items:center;margin-bottom:10px">
          <select id="timerMode" onchange="onTimerModeChange()" style="background:#080a10;border:1px solid var(--border);border-radius:4px;padding:8px 12px;color:#ddd;font-family:'IBM Plex Mono',monospace;font-size:11px;outline:none;width:200px">
            <option value="countdown">Manual Countdown</option>
            <option value="event">Event Schedule</option>
            <option value="none">No Timer (Open-Ended)</option>
          </select>
          <span style="font-family:'IBM Plex Mono',monospace;font-size:16px;color:var(--red);letter-spacing:3px;font-weight:700;text-shadow:0 0 8px rgba(255,50,50,.3)" id="apTimerDisplay">‚Äî</span>
        </div>
        <div id="timerCountdownControls">
          <div style="display:flex;gap:8px;align-items:center">
            <button class="admin-timer-btn" id="pauseBtn" onclick="togglePause()">‚è∏ PAUSE</button>
            <input class="admin-timer-input" id="timerInput" placeholder="HH:MM:SS" maxlength="8" style="width:120px">
            <button class="admin-timer-btn" onclick="setNewTime()">SET</button>
            <button class="admin-timer-btn" onclick="resetTimer()">RESET</button>
          </div>
        </div>
        <div id="timerEventControls" style="display:none">
          <div style="display:flex;gap:12px;flex-wrap:wrap;margin-bottom:8px">
            <div class="ap-field" style="flex:1;min-width:180px"><label>Event Start</label><input type="datetime-local" id="eventStartInput" onchange="onEventTimeChange()" style="background:#080a10;border:1px solid var(--border);border-radius:4px;padding:8px 12px;color:var(--green);font-family:'IBM Plex Mono',monospace;font-size:11px;width:100%;outline:none;color-scheme:dark"></div>
            <div class="ap-field" style="flex:1;min-width:180px"><label>Event End</label><input type="datetime-local" id="eventEndInput" onchange="onEventTimeChange()" style="background:#080a10;border:1px solid var(--border);border-radius:4px;padding:8px 12px;color:var(--red);font-family:'IBM Plex Mono',monospace;font-size:11px;width:100%;outline:none;color-scheme:dark"></div>
          </div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:6px 16px">
            <label style="display:flex;align-items:center;gap:6px;cursor:pointer"><input type="checkbox" id="eventAutoLock" checked onchange="eventSettings.autoLock=this.checked"><span style="font-family:Chakra Petch,sans-serif;font-size:10px;color:#aaa">Auto-lock when timer expires</span></label>
            <label style="display:flex;align-items:center;gap:6px;cursor:pointer"><input type="checkbox" id="eventShowLeaderboard" checked onchange="eventSettings.showLeaderboardOnExpiry=this.checked"><span style="font-family:Chakra Petch,sans-serif;font-size:10px;color:#aaa">Reveal leaderboard on expiry</span></label>
          </div>
          <div id="eventStatusMsg" style="font-family:'IBM Plex Mono',monospace;font-size:9px;color:#666;letter-spacing:1px;margin-top:8px"></div>
          <div style="display:grid;grid-template-columns:1fr 1fr 1fr 1fr;gap:6px;margin-top:12px;padding-top:12px;border-top:1px solid rgba(255,255,255,.05)">
            <button class="ap-btn ap-btn-amber" id="eventPauseBtn" onclick="toggleEventPause()" style="font-size:9px;padding:5px 8px;width:100%">‚è∏ Pause</button>
            <button class="ap-btn ap-btn-red" onclick="forceEndEvent()" style="font-size:9px;padding:5px 8px;width:100%">‚õî Force End</button>
            <button class="ap-btn ap-btn-cyan" onclick="exportResults()" style="font-size:9px;padding:5px 8px;width:100%">üìä Export</button>
            <button class="ap-btn ap-btn-red" onclick="clearAllData()" style="font-size:9px;padding:5px 8px;width:100%;opacity:.7">üóë Clear</button>
          </div>
        </div>
      </div>
      <div style="display:flex;gap:16px;flex-wrap:wrap;margin-bottom:12px">
        <div class="ap-field"><label>Participant Mode</label><select id="apParticipantMode" onchange="onParticipantModeChange()" style="width:auto"><option value="team">Team Only</option><option value="individual">Individual Only</option><option value="hybrid">Open (Hybrid)</option></select></div>
        <div class="ap-field"><label>Leaderboard Style</label><select id="apLeaderboardStyle" onchange="updateRegSettings()" style="width:auto"><option value="mixed">Single Mixed</option><option value="split">Split by Type</option><option value="labeled">Single with Labels</option></select></div>
      </div>
      <div style="margin-bottom:12px">
        <label style="font-family:Saira,sans-serif;font-size:10px;color:#d0e8f0;letter-spacing:2px;text-transform:uppercase;font-weight:700;display:block;margin-bottom:8px">‚¨á Content Downloads</label>
        <label style="display:flex;align-items:center;gap:6px;cursor:pointer"><input type="checkbox" id="apAllowDownloads" onchange="toggleAllowDownloads(this.checked)"><span style="font-family:Chakra Petch,sans-serif;font-size:10px;color:#aaa">Allow players to download files from Intelligence Feed and Evidence Locker</span></label>
      </div>
      <div style="margin-bottom:12px">
        <label style="font-family:Saira,sans-serif;font-size:10px;color:#d0e8f0;letter-spacing:2px;text-transform:uppercase;font-weight:700;display:block;margin-bottom:8px">üîí Session Persistence</label>
        <label style="display:flex;align-items:center;gap:6px;cursor:pointer"><input type="checkbox" id="apSessionPersist" onchange="regSettings.sessionPersist=this.checked;saveEventConfigToBackend()" checked><span style="font-family:Chakra Petch,sans-serif;font-size:10px;color:#aaa">Keep players logged in after browser close (uncheck to require re-login on each browser session)</span></label>
      </div>
      <div style="margin-top:12px">
        <label style="font-family:Saira,sans-serif;font-size:10px;color:#d0e8f0;letter-spacing:2px;text-transform:uppercase;font-weight:700;display:block;margin-bottom:8px">üü¢ Activity Thresholds <span class="save-blip" id="blipThresholds">‚úì Saved</span></label>
        <p style="font-family:Chakra Petch,sans-serif;font-size:10px;color:#666;margin:0 0 8px;letter-spacing:.3px">Controls when console tile status changes from Active ‚Üí Idle ‚Üí Silent.</p>
        <div class="ap-two-col">
          <div class="ap-field"><label>Active ‚Üí Idle (seconds)</label><input type="number" id="apThresholdIdle" value="60" min="10" max="600" onchange="updateThresholds()" style="width:90px"></div>
          <div class="ap-field"><label>Idle ‚Üí Silent (seconds)</label><input type="number" id="apThresholdSilent" value="300" min="30" max="3600" onchange="updateThresholds()" style="width:90px"></div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- SCORING PANEL -->
<div id="scoringPanel">
  <div class="ap-container">
    <div class="ap-header"><h3>Scoring</h3><button class="mv-close" onclick="closeScoringPanel()">‚úï CLOSE</button></div>
    <div class="ap-section"><h4>Scoring Editor <span class="save-blip" id="blipScoring">‚úì Saved</span></h4>
      <p>Configure point values and matching rules for each intel field. Changes auto-save and affect grading immediately.</p>
      <div style="display:flex;gap:12px;align-items:center;margin-bottom:12px;flex-wrap:wrap">
        <div class="ap-field"><label>Default Points Per Field</label><input type="number" id="seDefaultPoints" value="10" min="1" max="1000" onchange="seApplyDefaultPoints()" style="width:80px"></div>
        <div class="ap-field"><label>Default Match Mode</label><select id="seDefaultMode" onchange="seApplyDefaultMode()" style="width:auto"><option value="exact">Exact</option><option value="contains">Contains</option><option value="fuzzy">Fuzzy</option></select></div>
        <div class="ap-field"><label>Time Bonus</label>
          <label style="display:flex;align-items:center;gap:6px;cursor:pointer;margin-top:4px"><input type="checkbox" id="seTimeBonus" onchange="updateScoringConfig()"><span style="font-family:Chakra Petch,sans-serif;font-size:10px;color:#999">Award bonus points for early submission</span></label>
        </div>
      </div>
      <div style="display:flex;gap:12px;align-items:center;margin-bottom:12px;flex-wrap:wrap" id="seTimeBonusConfig" style="display:none">
        <div class="ap-field"><label>Max Time Bonus</label><input type="number" id="seTimeBonusMax" value="50" min="0" max="500" onchange="updateScoringConfig()" style="width:80px"></div>
        <div class="ap-field"><label>Bonus Decay</label><select id="seTimeBonusDecay" onchange="updateScoringConfig()" style="width:auto"><option value="linear">Linear</option><option value="exponential">Exponential</option></select></div>
      </div>
      <div style="border:1px solid var(--border);border-radius:6px;overflow:hidden;margin-bottom:12px">
        <div style="display:grid;grid-template-columns:2fr 80px 100px 80px;gap:0;font-family:Saira,sans-serif;font-size:9px;letter-spacing:1px;color:#888;font-weight:700;text-transform:uppercase;padding:8px 12px;background:rgba(255,255,255,.02);border-bottom:1px solid var(--border)">
          <div>Field</div><div style="text-align:center">Points</div><div style="text-align:center">Match Mode</div><div style="text-align:center">Fuzzy %</div>
        </div>
        <div id="seFieldList" style="max-height:400px;overflow-y:auto"></div>
      </div>
      <div style="display:flex;gap:12px;align-items:center;flex-wrap:wrap">
        <div style="flex:1;font-family:IBM Plex Mono,monospace;font-size:11px;color:var(--green);letter-spacing:1px">Total Possible: <strong id="seTotalPossible">0</strong> pts</div>
        <button class="ap-btn ap-btn-cyan" onclick="seApplyDefaultPoints()" style="font-size:9px;padding:5px 12px">Apply Defaults to All</button>
      </div>
    </div>
  </div>
</div>

<!-- REGISTRATION PANEL -->
<div id="registrationPanel">
  <div class="ap-container">
    <div class="ap-header"><h3>Registration</h3><button class="mv-close" onclick="closeRegistrationPanel()">‚úï CLOSE</button></div>
    <div class="ap-section"><h4>Registration Settings</h4>
      <p>Configure team registration parameters. Changes apply immediately.</p>
      <div style="display:flex;gap:20px;align-items:flex-start;margin-bottom:12px;flex-wrap:wrap">
        <div class="ap-field"><label>Min Team Size</label><select id="apMinSize" onchange="updateRegSettings()" style="width:100px"><option>1</option><option selected>2</option><option>3</option><option>4</option><option>5</option><option>6</option></select></div>
        <div class="ap-field"><label>Max Team Size</label><select id="apMaxSize" onchange="updateRegSettings()" style="width:100px"><option>2</option><option>3</option><option selected>4</option><option>5</option><option>6</option></select></div>
        <div class="ap-field"><label>Max Teams</label><input type="number" id="apMaxTeams" value="20" min="2" max="100" onchange="updateRegSettings()" style="width:80px"></div>
      </div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:6px 16px;margin-bottom:12px">
        <label style="display:flex;align-items:center;gap:6px;cursor:pointer"><input type="checkbox" id="apReqEmail" checked onchange="updateRegSettings()"><span style="font-family:Chakra Petch,sans-serif;font-size:10px;color:#999;letter-spacing:.5px">Require Email Address</span></label>
        <label style="display:flex;align-items:center;gap:6px;cursor:pointer"><input type="checkbox" id="apReqPhone" onchange="updateRegSettings()"><span style="font-family:Chakra Petch,sans-serif;font-size:10px;color:#999;letter-spacing:.5px">Require Phone Number</span></label>
        <label style="display:flex;align-items:center;gap:6px;cursor:pointer"><input type="checkbox" id="apReqDept" onchange="updateRegSettings()"><span style="font-family:Chakra Petch,sans-serif;font-size:10px;color:#999;letter-spacing:.5px">Require Department</span></label>
      </div>
      <div style="display:flex;align-items:center;gap:10px;padding:10px 14px;border:1px solid rgba(0,255,136,.1);border-radius:4px;background:rgba(0,255,136,.02)">
        <label style="display:flex;align-items:center;gap:6px;cursor:pointer;flex:1"><input type="checkbox" id="apRegOpen" checked onchange="updateRegSettings()"><span style="font-family:Saira,sans-serif;font-size:10px;color:var(--green);letter-spacing:1px;font-weight:600">Registration Open</span></label>
        <span id="apRegStatus" style="font-family:IBM Plex Mono,monospace;font-size:9px;color:var(--green);letter-spacing:1px;font-weight:700">‚óè OPEN</span>
      </div>
    </div>
  </div>
</div>

<!-- APPEARANCE PANEL -->
<div id="appearancePanel">
  <div class="ap-container">
    <div class="ap-header"><h3>Appearance</h3><button class="mv-close" onclick="closeAppearancePanel()">‚úï CLOSE</button></div>
    <div class="ap-section"><h4>Landing Page</h4>
      <p>Customize the landing page banner and text.</p>
      <div class="ap-field" style="margin-bottom:10px"><label>Banner Image</label>
        <div style="display:flex;gap:8px;align-items:center">
          <label style="cursor:pointer;font-size:9px;color:var(--cyan);letter-spacing:1px;padding:8px 14px;border:1px solid rgba(0,212,255,.2);border-radius:3px;background:rgba(0,212,255,.05);white-space:nowrap;font-family:'IBM Plex Mono',monospace;flex-shrink:0">
            üìÅ Upload Image
            <input type="file" accept="image/*" onchange="handleAdminBannerUpload(this)" style="display:none">
          </label>
          <button class="ap-btn ap-btn-red" onclick="clearLandingBanner()" style="font-size:9px;padding:6px 10px;flex-shrink:0">‚úï Clear</button>
        </div>
      </div>
      <div style="display:flex;gap:20px;align-items:center;margin-bottom:14px;padding:12px 16px;background:rgba(255,255,255,.015);border:1px solid rgba(255,255,255,.04);border-radius:6px">
        <div class="banner-preview" id="apBannerPreview"><span class="bp-emoji" id="apBannerFallbackPreview">üîê</span></div>
        <div style="flex:1;min-width:0">
          <div class="ap-field" style="margin-bottom:8px"><label>Fallback Icon</label>
            <div style="display:flex;align-items:center;gap:10px">
              <input id="apBannerFallback" value="üîê" onchange="updateBannerFallback()" style="width:54px;text-align:center;font-size:18px;background:#080a10;border:1px solid rgba(255,255,255,.08);border-radius:3px;padding:6px;color:#ddd;outline:none" maxlength="4">
              <span style="font-family:Chakra Petch,sans-serif;font-size:9px;color:#555">Shown when no image is uploaded</span>
            </div>
          </div>
          <div style="font-family:'IBM Plex Mono',monospace;font-size:8px;color:#555;letter-spacing:.5px" id="apBannerStatus">No image set</div>
        </div>
      </div>
      <div class="ap-two-col-even" style="margin-bottom:12px">
        <div class="ap-field"><label>Title <span class="save-blip" id="blipLandingTitle">‚úì Saved</span></label><input id="apLandingTitle" value="Code Breakers" onchange="updateLandingTitle()"></div>
        <div class="ap-field"><label>Subtitle <span class="save-blip" id="blipLandingSub">‚úì Saved</span></label><input id="apLandingSubtitle" value="Rise to The Challenge" onchange="updateLandingSubtitle()"></div>
      </div>
      <div style="text-align:center;padding-top:4px"><button class="ap-btn ap-btn-cyan" onclick="previewLandingPage()" style="font-size:10px;padding:8px 20px">üëÅ Preview Landing Page</button></div>
    </div>
    <div class="ap-section"><h4>Console Background <span class="save-blip" id="blipConsoleBg">‚úì Saved</span></h4>
      <p>Set the background color and overlay texture for the console screen. Affects all users in real-time.</p>
      <div style="display:flex;gap:20px;flex-wrap:wrap;margin-top:12px">
        <div style="flex:1;min-width:200px">
          <label style="font-family:Saira,sans-serif;font-size:9px;letter-spacing:2px;color:#666;text-transform:uppercase;display:block;margin-bottom:8px">Background Color</label>
          <div style="display:flex;align-items:center;gap:10px">
            <input type="color" id="consoleBgColor" value="#080a10" onchange="updateConsoleBg()" style="width:48px;height:36px;border:1px solid var(--border);border-radius:4px;background:transparent;cursor:pointer;padding:2px">
            <input id="consoleBgHex" value="#080a10" onchange="document.getElementById('consoleBgColor').value=this.value;updateConsoleBg()" style="width:90px;font-family:IBM Plex Mono,monospace;font-size:11px;background:#080a10;border:1px solid var(--border);border-radius:3px;padding:6px 8px;color:#aaa;outline:none;letter-spacing:1px">
          </div>
          <div style="display:flex;gap:6px;margin-top:10px;flex-wrap:wrap">
            <button class="cbg-preset" onclick="setConsoleBgColor('#080a10')" title="Default Black" style="width:28px;height:28px;border-radius:4px;border:1px solid var(--border);background:#080a10;cursor:pointer"></button>
            <button class="cbg-preset" onclick="setConsoleBgColor('#0a1628')" title="Dark Navy" style="width:28px;height:28px;border-radius:4px;border:1px solid var(--border);background:#0a1628;cursor:pointer"></button>
            <button class="cbg-preset" onclick="setConsoleBgColor('#1a1f2e')" title="Dark Slate" style="width:28px;height:28px;border-radius:4px;border:1px solid var(--border);background:#1a1f2e;cursor:pointer"></button>
            <button class="cbg-preset" onclick="setConsoleBgColor('#1e1e24')" title="Deep Charcoal" style="width:28px;height:28px;border-radius:4px;border:1px solid var(--border);background:#1e1e24;cursor:pointer"></button>
            <button class="cbg-preset" onclick="setConsoleBgColor('#0d1a0d')" title="Dark Green" style="width:28px;height:28px;border-radius:4px;border:1px solid var(--border);background:#0d1a0d;cursor:pointer"></button>
            <button class="cbg-preset" onclick="setConsoleBgColor('#1a0a0a')" title="Dark Red" style="width:28px;height:28px;border-radius:4px;border:1px solid var(--border);background:#1a0a0a;cursor:pointer"></button>
            <button class="cbg-preset" onclick="setConsoleBgColor('#12121a')" title="Dark Purple" style="width:28px;height:28px;border-radius:4px;border:1px solid var(--border);background:#12121a;cursor:pointer"></button>
          </div>
        </div>
        <div style="flex:1;min-width:200px">
          <label style="font-family:Saira,sans-serif;font-size:9px;letter-spacing:2px;color:#666;text-transform:uppercase;display:block;margin-bottom:8px">Texture Overlay</label>
          <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:6px" id="consoleBgTextureGrid">
            <button class="cbg-tex active" data-tex="none" onclick="setConsoleTexture('none')"><span class="cbg-tex-preview" style="background:#080a10"></span><span class="cbg-tex-label">None</span></button>
            <button class="cbg-tex" data-tex="scanlines" onclick="setConsoleTexture('scanlines')"><span class="cbg-tex-preview" style="background:repeating-linear-gradient(0deg,transparent,transparent 2px,rgba(255,255,255,.03) 2px,rgba(255,255,255,.03) 4px)"></span><span class="cbg-tex-label">Scanlines</span></button>
            <button class="cbg-tex" data-tex="grid" onclick="setConsoleTexture('grid')"><span class="cbg-tex-preview" style="background:repeating-linear-gradient(0deg,transparent,transparent 11px,rgba(0,255,136,.04) 11px,rgba(0,255,136,.04) 12px),repeating-linear-gradient(90deg,transparent,transparent 11px,rgba(0,255,136,.04) 11px,rgba(0,255,136,.04) 12px)"></span><span class="cbg-tex-label">Grid</span></button>
            <button class="cbg-tex" data-tex="noise" onclick="setConsoleTexture('noise')"><span class="cbg-tex-preview cbg-noise-preview"></span><span class="cbg-tex-label">Noise</span></button>
            <button class="cbg-tex" data-tex="circuit" onclick="setConsoleTexture('circuit')"><span class="cbg-tex-preview" style="background:repeating-linear-gradient(90deg,transparent,transparent 20px,rgba(0,212,255,.03) 20px,rgba(0,212,255,.03) 21px),repeating-linear-gradient(0deg,transparent,transparent 30px,rgba(0,212,255,.03) 30px,rgba(0,212,255,.03) 31px),repeating-linear-gradient(45deg,transparent 0px,transparent 28px,rgba(0,212,255,.02) 28px,rgba(0,212,255,.02) 29px)"></span><span class="cbg-tex-label">Circuit</span></button>
            <button class="cbg-tex" data-tex="hex" onclick="setConsoleTexture('hex')"><span class="cbg-tex-preview cbg-hex-preview"></span><span class="cbg-tex-label">Hex</span></button>
          </div>
          <div style="margin-top:10px">
            <label style="font-family:Saira,sans-serif;font-size:8px;letter-spacing:2px;color:#555;text-transform:uppercase;display:block;margin-bottom:4px">Texture Opacity: <span id="texOpacityVal">40%</span></label>
            <input type="range" id="consoleBgTexOpacity" min="10" max="100" value="40" oninput="updateTexOpacity()" style="width:100%;accent-color:var(--cyan)">
          </div>
        </div>
      </div>
      <div style="margin-top:14px;text-align:center">
        <button class="ap-btn ap-btn-ghost" onclick="resetConsoleBg()" style="font-size:9px;padding:7px 20px">‚Ü∫ Reset to Default</button>
      </div>
    </div>
    <div class="ap-section"><h4>Intel Theme <span class="save-blip" id="blipIntelTheme">‚úì Saved</span></h4>
      <p>Visual style for the Intel Submissions screen. Standard is clean and minimal. CRT adds scanlines, phosphor glow, and vignette for an immersive terminal feel.</p>
      <div style="display:flex;align-items:center;gap:14px;margin-top:8px">
        <div style="font-family:'IBM Plex Mono',monospace;font-size:11px;color:var(--green);letter-spacing:1px" id="currentIntelThemeLabel">Current: Standard</div>
        <button class="ap-btn ap-btn-cyan" onclick="openIntelThemePreview()" style="font-size:10px;padding:8px 20px">üëÅ Preview & Select</button>
      </div>
    </div>
    <div class="ap-section"><h4>Typography <span class="save-blip" id="blipTypography">‚úì Saved</span></h4>
      <p>Global font overrides by content zone. Setting a font here overrides the theme default for that zone across the whole app. Leave as Default to inherit the theme font.</p>
      <div style="display:flex;flex-direction:column;gap:14px;margin-bottom:14px">

        <div style="font-family:Saira,sans-serif;font-size:9px;letter-spacing:2px;color:#555;text-transform:uppercase;font-weight:600;padding-bottom:6px;border-bottom:1px solid rgba(255,255,255,.04)">Intelligence Feed</div>
        <div class="ap-two-col-even" style="margin-bottom:0">
          <div class="ap-field">
            <label>Feed Captions</label>
            <div id="fc_feedCap_wrap"></div>
            <div style="font-family:Chakra Petch,sans-serif;font-size:9px;color:#555;margin-top:4px;letter-spacing:.3px">Caption text beneath each image or clip in the Intelligence Feed grid and focus view.</div>
          </div>
        </div>

        <div style="font-family:Saira,sans-serif;font-size:9px;letter-spacing:2px;color:#555;text-transform:uppercase;font-weight:600;padding-bottom:6px;border-bottom:1px solid rgba(255,255,255,.04)">Evidence Locker</div>
        <div class="ap-two-col-even" style="margin-bottom:0">
          <div class="ap-field">
            <label>Item Titles</label>
            <div id="fc_mediaName_wrap"></div>
            <div style="font-family:Chakra Petch,sans-serif;font-size:9px;color:#555;margin-top:4px;letter-spacing:.3px">The bold title on each evidence card in the Evidence Locker panel.</div>
          </div>
          <div class="ap-field">
            <label>Item Descriptions</label>
            <div id="fc_mediaDesc_wrap"></div>
            <div style="font-family:Chakra Petch,sans-serif;font-size:9px;color:#555;margin-top:4px;letter-spacing:.3px">The secondary description line beneath each evidence item title.</div>
          </div>
        </div>

        <div style="font-family:Saira,sans-serif;font-size:9px;letter-spacing:2px;color:#555;text-transform:uppercase;font-weight:600;padding-bottom:6px;border-bottom:1px solid rgba(255,255,255,.04)">The Vault</div>
        <div class="ap-two-col-even" style="margin-bottom:0">
          <div class="ap-field">
            <label>Keypad Display</label>
            <div id="fc_vaultDisplay_wrap"></div>
            <div style="font-family:Chakra Petch,sans-serif;font-size:9px;color:#555;margin-top:4px;letter-spacing:.3px">The large character display on The Vault keypad as teams type their code.</div>
          </div>
        </div>

        <div style="font-family:Saira,sans-serif;font-size:9px;letter-spacing:2px;color:#555;text-transform:uppercase;font-weight:600;padding-bottom:6px;border-bottom:1px solid rgba(255,255,255,.04)">Intel Submissions</div>
        <div class="ap-two-col-even" style="margin-bottom:0">
          <div class="ap-field">
            <label>Field Labels</label>
            <div id="fc_intelLabel_wrap"></div>
            <div style="font-family:Chakra Petch,sans-serif;font-size:9px;color:#555;margin-top:4px;letter-spacing:.3px">The question label to the left of each intel answer field.</div>
          </div>
          <div class="ap-field">
            <label>Answer Inputs</label>
            <div id="fc_intelInput_wrap"></div>
            <div style="font-family:Chakra Petch,sans-serif;font-size:9px;color:#555;margin-top:4px;letter-spacing:.3px">The typed text inside answer input boxes across all intel field types.</div>
          </div>
        </div>

      </div>
      <div style="text-align:center;padding-top:4px"><button class="ap-btn ap-btn-ghost" onclick="resetFontConfig()" style="font-size:9px;padding:7px 20px">‚Ü∫ Reset All to Default</button></div>
    </div>
  </div>
</div>

<!-- TEAM MONITOR PANEL -->
<div id="dashboardPanel">
  <div class="ap-container" style="width:700px">
    <div class="ap-header"><h3>Dashboard</h3><button class="mv-close" onclick="closeDashboard()">‚úï CLOSE</button></div>
    <div id="dashMonitorView">
    <div class="ap-section">
      <p>Real-time view of all registered teams and their activity status. Teams inactive for 5+ minutes are flagged.</p>
      <div style="display:flex;gap:8px;margin-bottom:12px">
        <div class="ap-status-pill active"><span class="ap-status-dot on"></span> Active: <strong id="apActiveCount">0</strong></div>
        <div class="ap-status-pill idle" style="border:1px solid rgba(240,200,120,.15);background:rgba(240,200,120,.04);color:rgba(240,200,120,.7)"><span class="ap-status-dot" style="background:#f0c878"></span> Idle: <strong id="apInactiveCount">0</strong></div>
        <div class="ap-status-pill" style="border:1px solid rgba(255,51,51,.15);background:rgba(255,51,51,.04);color:rgba(255,100,100,.7);display:none"><span class="ap-status-dot" style="background:#ff4444"></span> Ghost: <strong id="apGhostCount">0</strong></div>
        <div class="ap-status-pill total">Total: <strong id="apTotalCount">0</strong></div>
      </div>
      <div class="ap-team-list" id="apTeamMonitor" style="max-height:none"></div>
      <div id="tmNukeBar" style="display:none;padding:8px 12px;margin:6px 0;background:rgba(255,51,51,.06);border:1px solid rgba(255,51,51,.2);border-radius:4px;display:none;align-items:center;gap:10px">
        <span style="font-family:Chakra Petch,sans-serif;font-size:9px;color:#ff6666;letter-spacing:1px" id="tmNukeCount">0 selected</span>
        <button onclick="nukeSelectedTeams()" style="margin-left:auto;font-family:IBM Plex Mono,monospace;font-size:8px;letter-spacing:2px;color:#ff4444;background:rgba(255,51,51,.1);border:1px solid rgba(255,51,51,.3);border-radius:3px;padding:5px 12px;cursor:pointer">NUKE SELECTED</button>
      </div>
      <div class="lb-pagination" id="tmPagination"></div>
      <div style="display:flex;gap:8px;align-items:center;padding:8px 0;border-top:1px solid var(--border);margin-top:8px">
        <span style="font-family:Chakra Petch,sans-serif;font-size:9px;color:#666;font-size:10px">Per page:</span>
        <select id="tmPerPage" onchange="tmPerPage=parseInt(this.value);tmCurrentPage=0;renderTeamMonitor()" style="background:#080a10;border:1px solid var(--border);border-radius:3px;padding:3px 6px;color:#aaa;font-family:IBM Plex Mono,monospace;font-size:9px;outline:none">
          <option value="15" selected>15</option><option value="20">20</option><option value="25">25</option><option value="50">50</option>
        </select>
      </div>
    </div>
    </div>
  </div>
</div>

<!-- BROADCAST PANEL -->
<div id="broadcastPanel">
  <div class="bc-container">
    <div class="bc-header"><h3>Broadcast</h3><button class="mv-close" onclick="closeBroadcast()">‚úï CLOSE</button></div>
    <div class="bc-body">
      <div class="bc-tabs">
        <div class="bc-tab active" onclick="switchBcTab(this,'text')">üí¨ Text Message</div>
        <div class="bc-tab" onclick="switchBcTab(this,'voice')">üéôÔ∏è Voice Note</div>
      </div>
      <div id="bcTextTab">
        <textarea class="bc-textarea" id="bcMessage" placeholder="Type a message to broadcast to all players..."></textarea>
      </div>
      <div id="bcVoiceTab" style="display:none">
        <div class="bc-voice">
          <div class="bc-rec-btn" id="bcRecBtn" onclick="toggleRecording()">üéôÔ∏è</div>
          <div class="bc-rec-label" id="bcRecLabel">Tap to record</div>
          <div class="bc-preview" id="bcPreview" style="display:none">
            <audio id="bcAudioPreview" controls style="width:100%"></audio>
          </div>
        </div>
      </div>
      <div class="bc-footer">
        <button class="ap-btn ap-btn-cyan" onclick="closeBroadcast()">Cancel</button>
        <button class="ap-btn ap-btn-amber" onclick="sendBroadcast()">üì° Broadcast Now</button>
      </div>
    </div>
  </div>
</div>

<!-- PLAYER BROADCAST BANNER -->
<div id="playerBanner">
  <div class="pb-inner">
    <span class="pb-icon" id="pbIcon">üì¢</span>
    <div id="pbContent"></div>
    <span class="pb-close" onclick="dismissBanner()">‚úï</span>
    <div class="pb-progress" id="pbProgress"></div>
  </div>
</div>

<!-- FULL LEADERBOARD MODULE -->
<div id="leaderboardModule">
  <div class="lb-container">
    <div class="lb-header">
      <h3 class="lb-title">Live Leaderboard</h3>
      <div class="lb-header-right">
        <span class="lb-team-count" id="lbTeamCount">0 teams</span>
        <button class="mv-close" onclick="closeLeaderboard()">‚úï CLOSE</button>
      </div>
    </div>
    <div class="lb-toolbar">
      <input class="lb-search" id="lbSearch" placeholder="Search teams..." oninput="renderFullLeaderboard()">
      <div class="lb-filters">
        <button class="lb-filter active" data-f="all" onclick="setLbFilter(this,'all')">All</button>
        <button class="lb-filter" data-f="active" onclick="setLbFilter(this,'active')">Active</button>
        <button class="lb-filter" data-f="inactive" onclick="setLbFilter(this,'inactive')">Inactive</button>
        <button class="lb-filter" data-f="ghost" onclick="setLbFilter(this,'ghost')">Ghosts</button>
        <button class="lb-filter" data-f="submitted" onclick="setLbFilter(this,'submitted')">Submitted</button>
      </div>
      <div class="lb-sort">
        <span style="font-family:Chakra Petch,sans-serif;font-size:8px;color:#666;letter-spacing:1px">Sort:</span>
        <select id="lbSort" onchange="renderFullLeaderboard()" style="background:#080a10;border:1px solid var(--border);border-radius:3px;padding:6px 10px;color:#aaa;font-family:IBM Plex Mono,monospace;font-size:10px;outline:none">
          <option value="score">Score (High‚ÜíLow)</option>
          <option value="fields">Fields Completed</option>
          <option value="recent">Most Recent</option>
          <option value="name">Team Name (A‚ÜíZ)</option>
          <option value="registered">Registration Order</option>
        </select>
      </div>
    </div>
    <div class="lb-body" id="lbBody"></div>
    <div class="lb-pagination" id="lbPagination"></div>
    <div class="lb-admin-actions" id="lbAdminActions" style="display:none">
      <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap;padding:12px 16px;border-top:1px solid var(--border)">
        <button class="ap-btn ap-btn-amber" onclick="desubmitSelected()" style="font-size:9px;padding:5px 12px">‚Ü© De-submit Selected</button>
        <button class="ap-btn ap-btn-red" onclick="desubmitAll()" style="font-size:9px;padding:5px 12px">‚Ü© De-submit All</button>
        <div style="flex:1"></div>
        <span style="font-family:Chakra Petch,sans-serif;font-size:9px;color:#666;font-size:10px">Per page:</span>
        <select id="lbPerPage" onchange="lbPerPage=parseInt(this.value);lbCurrentPage=0;renderFullLeaderboard()" style="background:#080a10;border:1px solid var(--border);border-radius:3px;padding:5px 10px;color:#aaa;font-family:IBM Plex Mono,monospace;font-size:10px;outline:none">
          <option value="15" selected>15</option><option value="20">20</option><option value="25">25</option><option value="50">50</option>
        </select>
      </div>
    </div>
  </div>
</div>

<!-- KEYS & CODES PANEL -->
<div id="keysCodesPanel">
  <div class="kc-container">
    <div class="kc-header"><h3>Intel & Scoring</h3><button class="mv-close" onclick="closeKeysCodes()">‚úï CLOSE</button></div>
    <div class="kc-body" id="kcBody"></div>
  </div>
</div>
  <div class="console-topbar">
    <div style="display:flex;flex-direction:column;gap:2px">
      <div style="display:flex;align-items:center;gap:4px"><span class="console-title" id="consoleTitle">‚óà Operation Dead Drop</span><button class="admin-edit-inline" onclick="event.stopPropagation();editOperationName()">‚úé</button></div>
      <span id="buildStamp" style="display:none;font-family:'IBM Plex Mono',monospace;font-size:8px;color:#333;letter-spacing:1px"></span>
    </div>
    <div style="display:flex;align-items:center">
      <div class="timer-block"><div class="timer-digits" id="cTimer">‚àû</div><div class="timer-label">Time Remaining</div></div>
    </div>
    <div class="topbar-identity" onclick="toggleTeamCard(event)">
      <span class="console-team">‚Äî</span>
      <span class="admin-topbar-label">ADMIN</span>
      <span class="team-chevron">‚ñæ</span>
      <span class="team-notif-badge" id="teamNotifBadge"></span>
      <div class="team-card" id="teamCard">
        <div class="team-card-header">
          <div class="team-card-name">‚Äî</div>
          <div class="team-card-id">ID: ‚Äî</div>
        </div>
        <div class="team-card-body">
          <div class="team-card-section">
            <div class="team-card-label">Operatives</div>
          </div>
          <div class="team-card-section">
            <div class="team-card-label">Mission Status</div>
            <div class="team-card-stats">
              <div class="team-card-stat"><div class="team-card-stat-val" id="tcElapsed">00:00</div><div class="team-card-stat-lbl">Elapsed</div></div>
              <div class="team-card-stat"><div class="team-card-stat-val" id="tcIntel">0 / 10</div><div class="team-card-stat-lbl">Intel Entered</div></div>
            </div>
          </div>
          <div class="team-card-notifs" id="teamCardNotifs">
            <div class="team-card-label" style="display:flex;align-items:center;justify-content:space-between">Notifications <span class="notif-clear-link" onclick="event.stopPropagation();clearNotifications()">Clear all</span></div>
            <div class="team-card-notif-list" id="teamNotifList"><div class="notif-empty">No notifications yet</div></div>
          </div>
          <div style="padding:4px 16px 0;border-top:1px solid rgba(255,255,255,.04)">
            <div onclick="event.stopPropagation();toggleTeamCard();setTimeout(replayTutorial,200)" style="display:flex;align-items:center;gap:8px;padding:8px 0;cursor:pointer;opacity:.6;transition:opacity .15s" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='.6'">
              <span style="font-size:12px">üìñ</span><span style="font-family:Chakra Petch,sans-serif;font-size:10px;color:#aaa;letter-spacing:.5px">Replay Tutorial</span>
            </div>
          </div>
          <div onclick="event.stopPropagation();toggleTeamCard();openChangePassword()" style="display:none;align-items:center;gap:8px;padding:8px 16px;cursor:pointer;opacity:.6;transition:opacity .15s;border-top:1px solid rgba(255,255,255,.04)" class="admin-only-card-item" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='.6'">
            <span style="font-size:12px">üîë</span><span style="font-family:Chakra Petch,sans-serif;font-size:10px;color:#aaa;letter-spacing:.5px">Change Password</span>
          </div>
          <div class="team-card-logout" onclick="event.stopPropagation();showLogout()">
            <svg viewBox="0 0 24 24" style="width:14px;height:14px;fill:none;stroke:var(--red);stroke-width:2;stroke-linecap:round;stroke-linejoin:round"><polyline points="15 18 9 12 15 6"/></svg>
            <span>Logout</span>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="console-grid" id="consoleGrid"></div>
  <div class="console-worldmap"></div>
</div>

<!-- Logout button ‚Äî body level for z-index independence -->

<div id="notepadPanel">
  <div class="notepad-header">
    <span class="notepad-header-icon">üìù</span>
    <span class="notepad-header-title">Notepad</span>
    <div class="notepad-header-actions">
      <button class="btn-standard btn-ghost" style="padding:5px 14px;font-size:9px" onclick="toggleNotepad()">‚úï CLOSE</button>
    </div>
  </div>
  <div class="notepad-hint">Use this space to jot down observations, track theories, and coordinate with your team.</div>
  <div class="notepad-body">
    <textarea class="notepad-textarea" id="notepadText" placeholder="Start typing your notes..." oninput="onNoteInput()"></textarea>
  </div>
  <div class="notepad-footer">
    <span class="notepad-charcount" id="notepadCount">0 characters</span>
    <button class="notepad-clear" onclick="clearNotes()">Clear All Notes</button>
  </div>
</div>

<!-- EXPANDED -->
<div id="panelOverlay">
  <div class="expanded-panel" id="expFeed"><div class="exp-header"><span class="panel-icon">üì°</span><span class="exp-title">Intelligence Feed</span><span id="feedCountIndicator" class="feed-count-badge"></span><div style="margin-left:auto"></div><div id="feedViewToggle" class="feed-view-toggle"><div class="feed-view-btn active" onclick="setFeedView('grid')" id="fvGrid">‚ó´ Grid</div><div class="feed-view-btn" onclick="setFeedView('single')" id="fvSingle">‚óª Focus</div></div><button class="exp-close" id="feedCloseBtn" onclick="feedClose()">‚úï CLOSE</button></div><div class="exp-body" id="feedExpBody"><div id="feedGridView" class="feed-expanded"></div><div id="feedSingleView" class="feed-single"><div class="feed-single-img" id="singleImg"></div><div class="feed-single-controls"><div class="feed-single-nav-row"><button class="feed-nav-btn" onclick="navPost(-1)">‚óÇ PREV</button><span class="feed-single-counter" id="singleCounter"></span><button class="feed-nav-btn" onclick="navPost(1)">NEXT ‚ñ∏</button></div></div><div class="feed-single-cap-zone"><div class="feed-single-caption" id="singleCap"></div><div class="feed-single-caption-more" id="feedCapMore" onclick="toggleFeedCaption()">‚ñæ more</div><div class="feed-single-cap-overlay" id="feedCapOverlay"><div class="feed-single-cap-overlay-text" id="feedCapOverlayText"></div><div class="feed-single-cap-overlay-close" onclick="closeFeedCapOverlay()">‚ñ¥ less</div></div></div><div class="swipe-hint">‚Üê Swipe or use arrow keys ‚Üí</div></div></div></div>
  <div class="expanded-panel" id="expMedia"><div class="exp-header"><span class="panel-icon">üóÇÔ∏è</span><span class="exp-title">Evidence Locker</span><span id="mediaCountIndicator" class="feed-count-badge"></span><span style="flex:1"></span><button class="exp-close" onclick="closePanel()">‚úï CLOSE</button></div><div class="exp-body"><div style="margin-bottom:8px"><input id="mediaSearchFilter" placeholder="Search files..." oninput="renderMedia()" style="width:100%;background:#080a10;border:1px solid var(--border);border-radius:3px;padding:8px 12px;color:#ddd;font-family:'IBM Plex Mono',monospace;font-size:10px;letter-spacing:1px;outline:none"></div><div id="mediaSelectBar" style="display:none;padding:8px 12px;background:rgba(255,51,51,.06);border:1px solid rgba(255,51,51,.15);border-radius:5px;margin-bottom:10px;align-items:center;gap:10px"><span id="mediaSelectCount" style="font-family:'IBM Plex Mono',monospace;font-size:11px;color:#aaa;flex:1">0 selected</span><button onclick="selectAllMedia()" style="font-family:'Saira',sans-serif;font-size:10px;letter-spacing:1px;background:none;border:1px solid #444;border-radius:3px;padding:4px 10px;color:#aaa;cursor:pointer">SELECT ALL</button><button onclick="deleteSelectedMedia()" style="font-family:'Saira',sans-serif;font-size:10px;letter-spacing:1px;background:rgba(255,51,51,.15);border:1px solid rgba(255,51,51,.3);border-radius:3px;padding:4px 12px;color:var(--red);cursor:pointer">üóë DELETE SELECTED</button><button onclick="exitMediaSelectMode()" style="font-family:'Saira',sans-serif;font-size:10px;letter-spacing:1px;background:none;border:1px solid #333;border-radius:3px;padding:4px 10px;color:#666;cursor:pointer">CANCEL</button></div><div id="mediaList" class="media-expanded"></div></div></div>
  <div class="expanded-panel" id="expIntel"><div class="exp-header"><span class="panel-icon">üéØ</span><span class="exp-title">Intel Submissions</span><button class="exp-close" onclick="closePanel()">‚úï CLOSE</button></div><div class="exp-body intel-exp-body"><div class="intel-scroll-area"><div class="intel-crt-header" style="text-align:center;justify-content:center"><div class="intel-crt-dot"></div> INTEL SUBMISSIONS</div><div class="intel-notice" id="intelNotice"><span class="intel-notice-icon">üíæ</span> Your answers save automatically as you type ‚Äî feel free to edit, revise, and change them as many times as you need. Once you press <strong>Submit Intel</strong>, your answers are locked in and cannot be changed.</div><div id="intelForm"></div></div><div class="intel-transmit-dock" id="intelTransmitDock"></div></div></div>
  <div class="expanded-panel" id="expVault">
    <div class="exp-header"><span class="panel-icon">üîê</span><span class="exp-title">The Vault</span><button class="exp-close" onclick="closePanel()">‚úï CLOSE</button></div>
    <div class="exp-body">
      <div class="vault-puzzle-layout">
        <div class="vault-keypad-section">
          <div class="vault-panel" id="vaultPanel">
            <div class="v-rate-limit" id="vRateLimit"><span class="v-rate-limit-text" id="vRateLimitText">‚ö† Security Lockout</span><span class="v-rate-limit-timer" id="vRateLimitTimer">30</span><div class="v-rate-limit-bar"><div class="v-rate-limit-fill" id="vRateLimitFill"></div></div><span class="v-rate-limit-sub" id="vRateLimitSub">Too many failed attempts</span></div>
            <div class="rv rv-1"></div><div class="rv rv-2"></div><div class="rv rv-3"></div><div class="rv rv-4"></div>
            <div class="v-display"><div class="v-disp-row"><span id="vDisp">ENTER CODE</span><span id="vCursor"></span></div><div class="v-tries" id="vkTries"></div></div>
            <div class="kb-row"><div class="kb-key" onclick="vkType('1')"><span>1</span></div><div class="kb-key" onclick="vkType('2')"><span>2</span></div><div class="kb-key" onclick="vkType('3')"><span>3</span></div><div class="kb-key" onclick="vkType('4')"><span>4</span></div><div class="kb-key" onclick="vkType('5')"><span>5</span></div><div class="kb-key" onclick="vkType('6')"><span>6</span></div><div class="kb-key" onclick="vkType('7')"><span>7</span></div><div class="kb-key" onclick="vkType('8')"><span>8</span></div><div class="kb-key" onclick="vkType('9')"><span>9</span></div><div class="kb-key" onclick="vkType('0')"><span>0</span></div></div>
            <div class="kb-row"><div class="kb-key" onclick="vkType('Q')"><span>Q</span></div><div class="kb-key" onclick="vkType('W')"><span>W</span></div><div class="kb-key" onclick="vkType('E')"><span>E</span></div><div class="kb-key" onclick="vkType('R')"><span>R</span></div><div class="kb-key" onclick="vkType('T')"><span>T</span></div><div class="kb-key" onclick="vkType('Y')"><span>Y</span></div><div class="kb-key" onclick="vkType('U')"><span>U</span></div><div class="kb-key" onclick="vkType('I')"><span>I</span></div><div class="kb-key" onclick="vkType('O')"><span>O</span></div><div class="kb-key" onclick="vkType('P')"><span>P</span></div></div>
            <div class="kb-row"><div class="kb-key" onclick="vkType('A')"><span>A</span></div><div class="kb-key" onclick="vkType('S')"><span>S</span></div><div class="kb-key" onclick="vkType('D')"><span>D</span></div><div class="kb-key" onclick="vkType('F')"><span>F</span></div><div class="kb-key" onclick="vkType('G')"><span>G</span></div><div class="kb-key" onclick="vkType('H')"><span>H</span></div><div class="kb-key" onclick="vkType('J')"><span>J</span></div><div class="kb-key" onclick="vkType('K')"><span>K</span></div><div class="kb-key" onclick="vkType('L')"><span>L</span></div></div>
            <div class="kb-row"><div class="kb-key fn clr-key" onclick="vkClear()"><span>CLR</span></div><div class="kb-key" onclick="vkType('Z')"><span>Z</span></div><div class="kb-key" onclick="vkType('X')"><span>X</span></div><div class="kb-key" onclick="vkType('C')"><span>C</span></div><div class="kb-key" onclick="vkType('V')"><span>V</span></div><div class="kb-key" onclick="vkType('B')"><span>B</span></div><div class="kb-key" onclick="vkType('N')"><span>N</span></div><div class="kb-key" onclick="vkType('M')"><span>M</span></div><div class="kb-key fn del-key" onclick="vkDel()"><span>‚å´</span></div></div>
            <div class="kb-row"><div class="kb-key fn sym-key" onclick="vkToggleSymbols()"><span id="vkSymLabel">SYM</span></div><div class="kb-key enter-key" style="flex:3" onclick="vkSubmit()"><span>ENTER</span></div></div>
            <div class="v-status" id="vkStatus" style="display:none"><div class="v-dot" id="vkDot"></div><span class="v-lbl" id="vkLbl"></span></div>
          </div>
        </div>
        <div class="vault-unlock-section">
          <div class="vault-unlock-header">
            <span class="vault-unlock-title">Vault Log</span>
            <span class="vault-unlock-count" id="vaultUnlockCount">0 OF 0 ITEMS UNLOCKED</span>
          </div>
          <div class="vault-unlock-list" id="vaultUnlockList">
            <div class="vault-unlock-empty">No codes entered yet. Solve puzzles across the Intelligence Feed and Evidence Locker to discover vault codes.</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- MEDIA VIEWER -->
<div id="mediaViewer">
  <div class="mv-container">
    <div class="mv-header">
      <div class="mv-header-info">
        <span class="mv-icon" id="mvIcon"></span>
        <div class="mv-header-text">
          <span class="mv-filename" id="mvName"></span>
          <span class="mv-filedesc" id="mvDesc"></span>
        </div>
        <span class="mv-badge" id="mvBadge"></span>
      </div>
      <button class="mv-download" id="mvDownload" onclick="downloadCurrentMedia()" style="display:none">‚¨á DOWNLOAD</button>
      <button class="mv-close" onclick="closeMediaViewer()">‚úï CLOSE</button>
    </div>
    <div class="mv-body" id="mvBody">
      <!-- Dynamic content injected here -->
    </div>
    <div class="mv-nav">
      <button class="mv-nav-btn" onclick="navMedia(-1)">‚óÇ PREV FILE</button>
      <span class="mv-nav-counter" id="mvCounter"></span>
      <button class="mv-nav-btn" onclick="navMedia(1)">NEXT FILE ‚ñ∏</button>
    </div>
  </div>
</div>


<!-- JavaScript Modules (order matters ‚Äî dependencies first) -->
<script src="./js/registration.js"></script>
<script src="./js/audio.js"></script>
<script src="./js/notepad.js"></script>
<script src="./js/login.js"></script>
<script src="./js/vault.js"></script>
<script src="./js/data-render.js"></script>
<script src="./js/panels.js"></script>
<script src="./js/feed-media.js"></script>
<script src="./js/intel.js"></script>
<script src="./js/media-viewer.js"></script>
<script src="./js/api.js"></script>
<script src="./js/navigation.js"></script>
<script src="./js/admin.js"></script>
<script src="./js/admin-modals.js"></script>
<script src="./js/drag-reorder.js"></script>
<script src="./js/timer.js"></script>
<script src="./js/event-config.js"></script>
<script src="./js/session-mgmt.js"></script>
<script src="./js/tutorial.js"></script>
<script src="./js/polling.js"></script>
<script src="./js/history.js"></script>
<script src="./js/console-bg.js"></script>
<script src="./js/intel-themes.js"></script>
<script src="./js/admin-nav.js"></script>
<script src="./js/gsap-effects.js"></script>
<script src="./js/globe.js"></script>



<!-- DASHBOARD SCREEN (full page) -->
<!-- SETTINGS SCREEN (full page ‚Äî unified admin) -->
<div class="screen" id="settingsScreen">
<div id="settingsBgOverlay"></div>
<div class="console-worldmap"></div>
  <div class="settings-topbar">
    <span class="settings-topbar-title">‚óà Admin Console</span>
    <button class="settings-topbar-close" onclick="returnFromAdminPage()" title="Return to console">‚úï CLOSE</button>
  </div>
  <div class="admin-page">
    <div class="admin-page-header">
      <div class="admin-page-tabs">
        <button class="admin-page-tab active" onclick="switchPageTab('settingsScreen','set-event',this)">Event</button>
        <button class="admin-page-tab" onclick="switchPageTab('settingsScreen','set-intel',this)">Intel & Scoring</button>
        <button class="admin-page-tab" onclick="switchPageTab('settingsScreen','set-appearance',this)">Appearance</button>
        <button class="admin-page-tab" onclick="switchPageTab('settingsScreen','set-users',this)">Users</button>
        <span class="admin-page-tab-sep"></span>
        <button class="admin-page-tab" onclick="switchPageTab('settingsScreen','dash-teams',this)">Teams</button>
        <button class="admin-page-tab" onclick="switchPageTab('settingsScreen','dash-leaderboard',this)">Leaderboard</button>
        <button class="admin-page-tab" onclick="switchPageTab('settingsScreen','dash-sessions',this)">Sessions</button>
        <button class="admin-page-tab" onclick="switchPageTab('settingsScreen','dash-broadcast',this)">Broadcast</button>
      </div>
    </div>
    <div class="admin-page-body">
      <div class="admin-page-section active" id="set-event"></div>
      <div class="admin-page-section" id="set-intel"></div>
      <div class="admin-page-section" id="set-appearance"></div>
      <div class="admin-page-section" id="set-users"></div>
      <div class="admin-page-section" id="dash-teams"></div>
      <div class="admin-page-section" id="dash-leaderboard"></div>
      <div class="admin-page-section" id="dash-sessions"></div>
      <div class="admin-page-section" id="dash-broadcast"></div>
    </div>
  </div>
</div>

<div id="adminNavBar">
  <div class="anb-btn" id="anb-dashboardPanel" onclick="switchAdminTab('dashboardPanel')" title="Dashboard">
    <span class="anb-icon">üìä</span><span class="anb-label">Live</span>
  </div>
  <div class="anb-sep"></div>
  <div class="anb-btn" id="anb-adminPanel" onclick="openSetup()" title="Setup">
    <span class="anb-icon">‚öôÔ∏è</span><span class="anb-label">Setup</span>
  </div>
</div>

<div id="landingPreviewOverlay">
  <div class="lp-preview-bar">
    <span class="lp-preview-label">üëÅ Player View Preview</span>
    <button class="lp-preview-nav" onclick="previewNav('landingScreen',this)">Landing</button>
    <button class="lp-preview-nav" onclick="previewNav('regScreen',this)">Register</button>
    <button class="lp-preview-nav" onclick="previewNav('loginScreen',this)">Login</button>
    <button class="lp-preview-close" onclick="closeLandingPreview()">‚úï Close</button>
  </div>
</div>

<!-- Intel Theme Preview Overlay -->
<div id="intelThemePreviewOverlay" style="position:fixed;inset:0;z-index:9600;background:rgba(0,0,0,.96);display:none;flex-direction:column">
  <div style="display:flex;align-items:center;justify-content:space-between;padding:12px 20px;background:rgba(0,0,0,.8);border-bottom:1px solid rgba(0,255,136,.1);flex-shrink:0;flex-wrap:wrap;gap:8px">
    <div style="display:flex;align-items:center;gap:12px">
      <span style="font-family:'Saira',sans-serif;font-size:11px;letter-spacing:3px;color:var(--green);font-weight:700">INTEL THEME PREVIEW</span>
      <span style="font-family:'IBM Plex Mono',monospace;font-size:10px;color:#666" id="intelThemePreviewName">Standard</span>
    </div>
    <div style="display:flex;align-items:center;gap:8px">
      <button onclick="cycleIntelThemePreview(-1)" style="padding:6px 14px;background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.1);border-radius:4px;color:#ccc;font-family:'IBM Plex Mono',monospace;font-size:11px;cursor:pointer;transition:all .15s" onmouseenter="this.style.borderColor='rgba(0,212,255,.3)'" onmouseleave="this.style.borderColor='rgba(255,255,255,.1)'">‚óÄ Prev</button>
      <span style="font-family:'IBM Plex Mono',monospace;font-size:10px;color:#555;min-width:40px;text-align:center" id="intelThemePreviewCounter">1 / 4</span>
      <button onclick="cycleIntelThemePreview(1)" style="padding:6px 14px;background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.1);border-radius:4px;color:#ccc;font-family:'IBM Plex Mono',monospace;font-size:11px;cursor:pointer;transition:all .15s" onmouseenter="this.style.borderColor='rgba(0,212,255,.3)'" onmouseleave="this.style.borderColor='rgba(255,255,255,.1)'">Next ‚ñ∂</button>
    </div>
    <div style="display:flex;align-items:center;gap:10px">
      <button onclick="applyIntelThemeFromPreview()" style="padding:7px 18px;background:rgba(0,255,136,.08);border:1px solid rgba(0,255,136,.25);border-radius:4px;color:var(--green);font-family:'Saira',sans-serif;font-size:10px;letter-spacing:2px;font-weight:700;cursor:pointer;transition:all .15s" onmouseenter="this.style.background='rgba(0,255,136,.15)'" onmouseleave="this.style.background='rgba(0,255,136,.08)'">‚úì SELECT</button>
      <button onclick="closeIntelThemePreview()" style="padding:7px 14px;background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.1);border-radius:4px;color:#999;font-family:'Saira',sans-serif;font-size:10px;letter-spacing:2px;cursor:pointer;transition:all .15s" onmouseenter="this.style.borderColor='rgba(255,50,50,.3)'" onmouseleave="this.style.borderColor='rgba(255,255,255,.1)'">‚úï CANCEL</button>
    </div>
  </div>
  <div style="flex:1;display:flex;align-items:flex-start;justify-content:center;overflow-y:auto;padding:20px">
    <div id="intelThemePreviewContent" style="width:100%;max-width:700px"></div>
  </div>
  <div style="padding:8px 20px;text-align:center;flex-shrink:0;border-top:1px solid rgba(255,255,255,.04)">
    <span style="font-family:'Chakra Petch',sans-serif;font-size:9px;color:#444;letter-spacing:1px">Use ‚óÄ ‚ñ∂ to browse styles ¬∑ Press SELECT to apply ¬∑ ESC to cancel</span>
  </div>
</div>

</body>
</html>
